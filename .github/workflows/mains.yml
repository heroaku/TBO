name: Sync Multiple Folders

on: workflow_dispatch

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Sync multiple repos
        run: |
          # é…ç½®Git
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
          # è¦åŒæ­¥çš„ä»“åº“åˆ—è¡¨
          repos=(
           # "NFXC:https://github.com/yoursmile66/TVBox.git"
           # "DBY:https://github.com/huangxinyueus/dby.git"
            # "N3RD:https://github.com/n3rddd/N3RD.git"
            "X:https://github.com/alantang1977/X.git"
          )
          
          echo "å¼€å§‹åŒæ­¥ ${#repos[@]} ä¸ªä»“åº“..."
          echo "================================"
          
          # éå†å¹¶åŒæ­¥æ¯ä¸ªä»“åº“
          for repo in "${repos[@]}"; do
            folder="${repo%%:*}"
            url="${repo#*:}"
            
            echo ""
            echo "ğŸ”„ [$folder]"
            echo "   æ¥æº: $url"
            
            # åˆ›å»ºä¸´æ—¶ç›®å½•
            tmp=$(mktemp -d)
            
            # å°è¯•å…‹éš†
            if git clone --depth 1 "$url" "$tmp" 2>/dev/null; then
              # å‡†å¤‡ç›®æ ‡æ–‡ä»¶å¤¹
              mkdir -p "$folder"
              rm -rf "$folder"/*
              
              # å¤åˆ¶æ–‡ä»¶
              cp -r "$tmp"/* "$folder"/ 2>/dev/null
              
              # ç»Ÿè®¡ç»“æœ
              count=$(find "$folder" -type f 2>/dev/null | wc -l)
              echo "   âœ… æˆåŠŸ ($count ä¸ªæ–‡ä»¶)"
            else
              echo "   âŒ å¤±è´¥"
            fi
            
            # æ¸…ç†
            rm -rf "$tmp"
          done
          
          echo ""
          echo "================================"
          echo "åŒæ­¥å®Œæˆï¼"
          
          # æäº¤æ›´æ”¹
          git add .
          git commit -m "Sync $(date)" || echo "æ— æ›´æ”¹"
          git push
