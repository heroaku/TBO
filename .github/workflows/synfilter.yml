name: Sync with Filter

on: workflow_dispatch

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Sync with file filtering
        run: |
          echo "同步并过滤文件..."
          
          # 创建临时目录
          tmp=$(mktemp -d)
          
          # 克隆仓库
          git clone --depth 1 https://github.com/alantang1977/X.git "$tmp"
          
          # 创建目标文件夹
          mkdir -p AX
          rm -rf AX/*
          
          echo "过滤文件..."
          
          # 只复制允许的文件类型（根据您的规则调整）
          # 示例：只复制文本文件
          find "$tmp" -type f \( \
            -name "*.md" -o \
            -name "*.txt" -o \
            -name "*.json" -o \
            -name "*.yml" -o \
            -name "*.yaml" -o \
            -name "*.xml" -o \
            -name "*.html" -o \
            -name "*.css" -o \
            -name "*.js" -o \
            -name "*.py" -o \
            -name "*.sh" \
            -name "*.jar" \
            -name "*.jpg" \
            -name "*.png" \
            -name "*.log" \
            -name "*.gif" \
          \) -exec cp --parents {} AX/ 2>/dev/null \; || true
          
          # 复制README文件（如果有）
          cp "$tmp/README.md" AX/ 2>/dev/null || true
          
          rm -rf "$tmp"
          
          echo "同步完成"
          echo "文件数量: $(find AX -type f 2>/dev/null | wc -l)"
          
      - name: Commit and push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
          git add .
          git commit -m "Sync filtered files"
          git push
