name: Sync Repositories

on: workflow_dispatch

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      # 1. æ£€å‡ºä»£ç 
      - uses: actions/checkout@v4
        
      # 2. é…ç½®Git
      - name: Setup Git
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
      # 3. æ‰¹é‡åŒæ­¥å¤šä¸ªä»“åº“
      - name: Sync multiple repositories
        run: |
          echo "=== å¼€å§‹æ‰¹é‡åŒæ­¥ ==="
          
          # è¦åŒæ­¥çš„ä»“åº“åˆ—è¡¨ï¼ˆæ ¼å¼ï¼šæ–‡ä»¶å¤¹å:ä»“åº“URLï¼‰
          repos=(
            "FM:https://github.com/qist/tvbox.git"
            "DBY:https://github.com/huangxinyueus/dby.git"
            "N3RD:https://github.com/n3rddd/N3RD.git"
            # åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šä»“åº“
            "XMB:https://github.com/xmbjm/svip.git"
            "BPT:https://github.com/BP3388/TVBOX.git"
            "NMB:https://github.com/ninemui/9muiBOX.git"
            "YWB:https://github.com/yuanwangokk-1/TV-BOX.git"
            "QIS:https://github.com/qist/tvbox.git"
          )
          
          for repo in "${repos[@]}"; do
            # è§£ææ–‡ä»¶å¤¹åå’ŒURL
            folder="${repo%%:*}"
            url="${repo#*:}"
            
            echo ""
            echo "ğŸ”„ åŒæ­¥: $folder"
            echo "æºä»“åº“: $url"
            
            # åˆ›å»ºä¸´æ—¶ç›®å½•
            tmp=$(mktemp -d)
            
            # å…‹éš†å¹¶å¤åˆ¶
            if git clone --depth 1 "$url" "$tmp" 2>/dev/null; then
              # å‡†å¤‡ç›®æ ‡æ–‡ä»¶å¤¹
              mkdir -p "$folder"
              rm -rf "$folder"/*
              
              # å¤åˆ¶æ–‡ä»¶
              cp -r "$tmp"/* "$folder"/ 2>/dev/null || true
              
              # ç»Ÿè®¡ç»“æœ
              count=$(find "$folder" -type f 2>/dev/null | wc -l)
              echo "âœ… æˆåŠŸ ($count ä¸ªæ–‡ä»¶)"
            else
              echo "âŒ å¤±è´¥"
            fi
            
            # æ¸…ç†
            rm -rf "$tmp"
          done
          
          echo ""
          echo "=== åŒæ­¥å®Œæˆ ==="
          
      # 4. æäº¤å’Œæ¨é€
      - name: Commit and push
        run: |
          # æ·»åŠ æ›´æ”¹
          git add .
          
          # æäº¤ï¼ˆä½¿ç”¨å®‰å…¨çš„ä¿¡æ¯ï¼‰
          git commit -m "Sync update" || exit 0
          
          # æ¨é€
          echo "æ¨é€åˆ°ä»“åº“..."
          git push
          
          echo ""
          echo "âœ… åŒæ­¥å®Œæˆå¹¶å·²æ¨é€ï¼"
          echo "ğŸ‘‰ æŸ¥çœ‹æ›´æ–°: https://github.com/${{ github.repository }}"
