name: Sync to Folders with Notification

on: workflow_dispatch

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Git
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
      
      - name: Sync DBY to folder
        run: |
          rm -rf DBY/*
          git clone --depth 1 https://github.com/huangxinyueus/dby.git /tmp/dby_temp
          cp -r /tmp/dby_temp/* DBY/ 2>/dev/null || true
          rm -rf /tmp/dby_temp
          echo "âœ… DBY åŒæ­¥å®Œæˆ"
      
      - name: Sync N3RD to folder
        run: |
          rm -rf N3RD/*
          git clone --depth 1 https://github.com/n3rddd/N3RD.git /tmp/n3rd_temp
          cp -r /tmp/n3rd_temp/* N3RD/ 2>/dev/null || true
          rm -rf /tmp/n3rd_temp
          echo "âœ… N3RD åŒæ­¥å®Œæˆ"
      
      - name: Generate sync report
        run: |
          # åˆ›å»ºåŒæ­¥æŠ¥å‘Š
          cat > SYNC_REPORT.md << 'EOF'
          # åŒæ­¥æŠ¥å‘Š
          
          ## åŒæ­¥æ—¶é—´
          $(date)
          
          ## åŒæ­¥ç»“æœ
          | æ–‡ä»¶å¤¹ | æ–‡ä»¶æ•°é‡ | çŠ¶æ€ |
          |--------|----------|------|
          | DBY | $(find DBY -type f 2>/dev/null | wc -l) | âœ… |
          | N3RD | $(find N3RD -type f 2>/dev/null | wc -l) | âœ… |
          
          ## æºä»“åº“
          - DBY: https://github.com/huangxinyueus/dby
          - N3RD: https://github.com/n3rddd/N3RD
          
          ## ä¸‹æ¬¡åŒæ­¥
          æ‰‹åŠ¨è¿è¡Œå·¥ä½œæµå³å¯æ›´æ–°ã€‚
          EOF
      
      - name: Commit and push
        run: |
          git add .
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ”„ åŒæ­¥æ›´æ–° - $(date)"
            git push
            echo "ğŸ‰ åŒæ­¥æˆåŠŸå¹¶å·²æ¨é€ï¼"
          else
            echo "âš ï¸ æ²¡æœ‰æ£€æµ‹åˆ°æ›´æ”¹"
          fi
