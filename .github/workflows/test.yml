name: Test N3RD Repository Access

on: workflow_dispatch

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Test various repository URLs
        run: |
          echo "=== 测试 N3RD 仓库各种可能的地址 ==="
          
          # 测试 1: 直接访问网页
          echo "1. 测试网页访问..."
          curl -s -o /dev/null -w "GitHub页面状态: %{http_code}\n" https://github.com/n3rddd/N3RD
          
          # 测试 2: 原始 URL
          echo "2. 测试原始 URL..."
          if curl -s -I https://github.com/n3rddd/N3RD.git | grep -q "200 OK"; then
            echo "✅ 原始 URL 可访问"
          else
            echo "❌ 原始 URL 不可访问"
          fi
          
          # 测试 3: 尝试不同的仓库名变体
          echo "3. 尝试不同的仓库名..."
          for repo in "N3RD" "n3rd" "N3rd" "n3rddd"; do
            echo "测试: https://github.com/n3rddd/${repo}.git"
            if git ls-remote https://github.com/n3rddd/${repo}.git 2>/dev/null | head -1; then
              echo "✅ ${repo} 存在"
              echo "WORKING_REPO=${repo}" >> $GITHUB_ENV
              break
            else
              echo "❌ ${repo} 不存在"
            fi
          done
          
          # 测试 4: 尝试不同的用户名
          echo "4. 尝试不同的用户名..."
          for user in "n3rddd" "n3rd" "N3RD" "N3rd"; do
            echo "测试: https://github.com/${user}/N3RD.git"
            if git ls-remote https://github.com/${user}/N3RD.git 2>/dev/null | head -1; then
              echo "✅ ${user}/N3RD 存在"
              echo "WORKING_REPO=N3RD" >> $GITHUB_ENV
              echo "WORKING_USER=${user}" >> $GITHUB_ENV
              break
            fi
          done
          
      - name: Show test results
        run: |
          echo "=== 测试结果 ==="
          echo "找到的仓库: ${WORKING_REPO:-未找到}"
          echo "找到的用户: ${WORKING_USER:-未找到}"
          
          if [ -z "$WORKING_REPO" ]; then
            echo "⚠️ 警告: 可能仓库不存在或已删除"
            echo "建议: 手动创建 N3RD 文件夹并添加测试文件"
          fi
